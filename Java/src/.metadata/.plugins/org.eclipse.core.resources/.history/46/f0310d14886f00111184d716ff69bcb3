package edu.ucsf.sdm;

import javax.swing.JOptionPane;

/**
 * This code compiles observations of alpha diversity (abundance matrix or flat file) and metadata (local observations and rasters) to generate a flat file suitable for use with niche modeling
 * @author jladau
 */
public class Main {

	public static void main(String rgsArgs[]){
	
		//sPath = current input path
		//sRasterDirt = directory containing the environmental rasters
		//rgsMetadata = Matrix with local observations collected at the time of sampling.  Samples not included in metadata file are excluded. Columns represent variables, rows represent sampling locations.
		//rgsSamples = Matrix with the observed abundances of taxa. First column with sample name, second column with taxon name, third column with number of reads.
		//rgsFilters = Matrix containing filtering strings.  Each row gives a filter: <variable>:<equals,notequals>:<value>.  Filters are applied to metadata file.   For instance, "temperature:equals:3" will include all samples with temperature equal to 3.
		//prc1 = ProcessData object
		//iRareIterations = number of rarefaction iterations
		//iTotalReads = rarefaction depth
		//bSeasonal = true if raster values are seasonal; false otherwise
		//rgsFiles = list of raster files
		
		int iRareIterations; int iTotalReads;
		ProcessData prc1;
		String sPath; String sRasterDir;
		String rgsMetadata[][]; String rgsSamples[][]; String rgsFilters[][]; String rgsFiles[];
		boolean bSeasonal=false;
		
		//loading number of rarefaction iterations
		iRareIterations = Integer.parseInt(JOptionPane.showInputDialog("Enter the number of rarefaction iterations:", "1000"));
		
		//loading the number of total reads
		iTotalReads = Integer.parseInt(JOptionPane.showInputDialog("Enter the sequencing depth to rarefy to:", "1000"));
		
		//loading metadata
		sPath = FileIO.getPath("Enter the file with the metadata:", "");
		rgsMetadata = FileIO.readFile(sPath, ",");
		
		//loading filters
		sPath = FileIO.getPath("Enter the file with the filters:", "");
		rgsFilters = FileIO.readFile(sPath, ",");
		
		//loading directory with rasters
		sRasterDir = FileIO.getPath("Enter the directory with the rasters:", "");
		
		//determining whether rasters are seasonal
		rgsFiles = FileIO.getFileList(sRasterDir);
		for(int i=0;i<rgsFiles.length;i++){
			if(rgsFiles[i].contains("_")){
				bSeasonal=true;
			}
		}
		
		
		//loading samples
		sPath = FileIO.getPath("Enter the file with the samples:", "");
		rgsSamples = FileIO.readFile(sPath, ",");
		
		//loading results
		prc1 = new ProcessData(rgsMetadata,rgsSamples,rgsFilters,sRasterDir,iRareIterations,iTotalReads,bSeasonal);
		
		//outputting results
		FileIO.writeFile(prc1.getProcessedData(), System.getProperty("user.home") + "/AlphaDiversity_Data.csv", ",", 0, false);
		
		//terminating
		JOptionPane.showMessageDialog(null, "Done.");	
	}
}
